<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>أفضل طرق للاستثمار</title>
<style>
body {font-family:Cairo, Tahoma, Arial, sans-serif; background:#f7fafc; color:#0f172a; margin:0; padding:20px;}
.wrap {max-width:1200px; margin:0 auto;}
header {background:linear-gradient(90deg,#0ea5a4,#2563eb); color:#fff; padding:22px; border-radius:12px; text-align:center; margin-bottom:20px;}
header h1 {margin:0; font-size:22px;}
.subtitle {color:rgba(255,255,255,0.9); margin-top:6px; font-size:14px;}
input {padding:6px; margin:4px 0; width:80px;}
.grid {display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:18px;}
.card {background:#fff; padding:16px; border-radius:12px; box-shadow:0 8px 20px rgba(2,6,23,0.06); text-align:center;}
.card h2 {margin:0 0 12px 0; font-size:18px;}
table {width:100%; border-collapse:collapse; margin-top:10px; font-size:14px;}
th, td {padding:8px; text-align:center; border-bottom:1px solid #eef2f6;}
th {background:#f1f5f9;}
.green {color:#059669; font-weight:700;}
.accent {color:#2563eb; font-weight:700;}
.blue{border-top:5px solid #3b82f6;}
.teal{border-top:5px solid #14b8a6;}
.yellow{border-top:5px solid #facc15;}
.orange{border-top:5px solid #fb923c;}
</style>
</head>
<body>

<div class="wrap">
<header>
  <h1>أفضل طرق للاستثمار</h1>
  <div class="subtitle">جميع الأرقام لمدة <span id="yearsLabel"></span> سنوات — بالجنيه المصري (ج.م)</div>
  <div style="margin-top:10px;">
    قيمة الشهادة: <input type="number" id="tdAmount" value="100000"> &nbsp;
    العائد السنوي (%): <input type="number" id="tdRate" value="17" step="0.01"> &nbsp;
    مدة الاستثمار: <input type="number" id="years" value="3"> سنوات &nbsp;
    <button onclick="render()">حساب</button>
    <button onclick="generateUrl()">نسخ الرابط</button>
  </div>
</header>

<div class="grid" id="scenarios"></div>
</div>

<script>
// دوال مساعدة
function PMT(monthlyRate, numberOfPayments, principal) {
  if (monthlyRate === 0) return principal / numberOfPayments;
  return (principal * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -numberOfPayments));
}
function roundTo100(value) { return Math.round(value/100)*100; }
function format(num) { return Number(num).toLocaleString("ar-EG",{minimumFractionDigits:0, maximumFractionDigits:2}); }
function displayValue(value) { if (value===0||value===null||value===undefined) return "-"; return format(value); }
function renderNetPay(value) { if(value == 0) return "&nbsp;"; else if(value < 0) return "🔼 فائض"; return format(value); }
function renderRow(label, value, isGreen=false, isNetPay=false) {
  const cls = isGreen ? "green" : "";
  let display = isNetPay ? renderNetPay(value) : ((value===0||value===null||value===undefined)?"&nbsp;":format(value));
  const displaylabel = (value===0||value===null||value===undefined)?"&nbsp;":label;
  return `<tr><td>${displaylabel}</td><td class="${cls}">${display}</td></tr>`;
}

// قراءة URL Params عند التحميل
function getUrlParams() {
  const params = new URLSearchParams(window.location.search);
  return {
    tdAmount: params.has("tdAmount") ? Number(params.get("tdAmount")) : 100000,
    tdRate: params.has("tdRate") ? Number(params.get("tdRate")) : 17,
    years: params.has("years") ? Number(params.get("years")) : 3
  };
}

// نسخ الرابط
function generateUrl() {
  const tdAmount = document.getElementById("tdAmount").value;
  const tdRate = document.getElementById("tdRate").value;
  const years = document.getElementById("years").value;
  
  const url = `${window.location.origin}${window.location.pathname}?tdAmount=${tdAmount}&tdRate=${tdRate}&years=${years}`; 
  navigator.clipboard.writeText(url);
  alert("تم نسخ الرابط");
}

// حساب أي سيناريو
function calculateScenario(tdAmount, tdRate, years, loanPercent=0, reinvest=false) {
  const months = years*12;
  const monthlyCertInterest = (tdAmount*tdRate)/12;
  const totalCertInterest = tdAmount*tdRate*years;

  let loan = roundTo100(tdAmount*loanPercent/100);
  const loanAnnualRate = Math.max(tdRate+0.02,0.20);
  const monthlyLoanRate = loanAnnualRate/12;
  const monthlyInstallment = loan>0 ? PMT(monthlyLoanRate, months, loan) : 0;
  const loanInterest = (monthlyInstallment*months) - loan;

  if(loanPercent===0) return {loan:0, monthlyInterest:monthlyCertInterest, monthlyInstallment:0, netMonthlyPay:0, totalInterest:totalCertInterest, finalAmount:tdAmount+totalCertInterest};

  if(reinvest) {  
    const loanMonthlyCertInterest = (loan*tdRate)/12;
    const totalInvest = tdAmount + loan;
    const totalInterest = totalInvest*tdRate*years;
    return {loan, monthlyInterest:(totalInvest*tdRate)/12, monthlyInstallment, netMonthlyPay:monthlyInstallment-loanMonthlyCertInterest-monthlyCertInterest, totalInterest, loanInterest, finalAmount:tdAmount+totalInterest-loanInterest};
  }

  return {loan, monthlyInterest:monthlyCertInterest, monthlyInstallment, netMonthlyPay:monthlyInstallment-monthlyCertInterest, totalInterest:totalCertInterest, loanInterest, finalAmount:tdAmount+totalCertInterest-loanInterest};
}

// عرض النتائج
function render() {
  const tdAmountInput = document.getElementById("tdAmount");
  const tdRateInput = document.getElementById("tdRate");
  const yearsInput = document.getElementById("years");

  const tdAmount = Number(tdAmountInput.value);
  const tdRate = Number(tdRateInput.value)/100;
  const years = Number(yearsInput.value);

  document.getElementById("yearsLabel").innerText = years;

  // تحديث URL Params تلقائياً
  const newUrl = `${window.location.pathname}?tdAmount=${tdAmount}&tdRate=${tdRateInput.value}&years=${years}`;
  window.history.replaceState({}, '', newUrl);

  const scenariosDiv = document.getElementById("scenarios");
  scenariosDiv.innerHTML = "";

  const scenariosData = [
    {title:"شهادة فقط", loanPercent:0, reinvest:false},
    {title:"الحد الاقصى للقرض", loanPercent:90, reinvest:false},
    {title:"الفائدة مقدماً", loanPercent:38, reinvest:false},
    {title:"قرض وشهادة", loanPercent:61, reinvest:true}
  ];

  const colors = ["blue","teal","yellow","orange"];

  scenariosData.forEach((s,i)=>{
    const res = calculateScenario(tdAmount, tdRate, years, s.loanPercent, s.reinvest);
    let html = `<div class="card ${colors[i]}"><h2>${s.title}</h2><table>
      ${renderRow("قيمة القرض", res.loan)}
      ${renderRow("العائد الشهري", res.monthlyInterest)}
      ${renderRow("القسط الشهري", res.monthlyInstallment)}
      ${renderRow("العميل يدفع فقط", res.netMonthlyPay, false, true)}
      ${renderRow("إجمالي الفوائد", res.totalInterest)}
      ${renderRow("فوائد القرض", res.loanInterest || 0)}
      ${renderRow("إجمالي نهائي", res.finalAmount, true)}
    </table></div>`;
    scenariosDiv.innerHTML += html;
  });
}

// تحميل القيم من URL عند بدء الصفحة
window.onload = () => {
  const params = getUrlParams();
  document.getElementById("tdAmount").value = params.tdAmount;
  document.getElementById("tdRate").value = params.tdRate;
  document.getElementById("years").value = params.years;
  render();
};
</script>

</body>
</html>
